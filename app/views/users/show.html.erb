<div class="container">

<div class="user-profile-page">
  <div class="profile-info">
        <div class="user-profile">
          <%#--Shows that this is YOUR profile page if it's yours %>
          <% if @user == current_user %>
            <h3><%= @user.username %></h3>
          <%#-- Otherwise shows the username %>
          <% else %>
            <h3><%= @user.username %></h3>
          <% end %>

        </div>


        <div class="followings">

          <%#-- Shows who follows you %>
          <% if @user.follows_received.empty? %>
            <button><b>0</b> Followers</button>
          <% else %>
          <button data-toggle="modal" data-target="#exampleModalLong">
            <b><%= @user.follows_received.count %></b> Followers
          </button>
            <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title" id="exampleModalLongTitle">Follwers</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                      <div class="modal-body">

                      <% @user.follows_received.each do |following| %>
                        <p><%= link_to following.follower.username, user_path(following.follower) %></p><br>
                      <% end %></p>

                      </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>


          <% end %>

          <%#-- Shows who you are following %>
          <% if @user.follows_given.empty? %>
            <button><b>0</b> Followers</button>
          <% else %>

          <button data-toggle="modal" data-target="#exampleModalLong">
            <b><%= @user.follows_given.count%></b> Following
          </button>
            <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title" id="exampleModalLongTitle">Following</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                      <div class="modal-body">
                      <% @user.follows_given.each do |following| %>
                        <p><%= link_to following.followee.username, user_path(following.followee) %></p><br>
                      <% end %>
                      </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>

          <% end %>

          <div class="follow-buttons">
            <%#-- Follow / Unfollow logic %>
            <% if current_user != @user && !current_user.follows_given.pluck(:followee_id).include?(@user.id) %>
              <%= link_to "Follow this foodie", follow_user_path(@user), method: :post %>
            <% elsif current_user != @user  %>
              <%= link_to "Unfollow this foodie", unfollow_user_path(@user), method: :delete %>
            <% end %>
          </div>

          <div class="index-link">
            <%#-- Link to users index %>
            <% if @user == current_user %>
            <i class="fas fa-users"></i>
              <%= link_to "Find foodie friends", users_path %>
            <% else %>
              <%= link_to "Find more foodies", users_path %>
              <br>
            <% end %>
          </div>

      </div>
    </div>

    <%#-- Show each bookmark... this needs to be turned into a card %>
    <div class="cookbook">
      <h3>Your Dishes</h3>
      <div class="cookbook-content">

        <!-- to be replaced by index card once created -->
        <div class="index-container">
          <% @user.bookmarks.each do |bookmark| %>
            <div class="index-box">
              <%=link_to recipe_path(bookmark.recipe.id) do %>
                <div class='index-card'>
                  <%=cl_image_tag bookmark.recipe.photo.key, height: 400 %>
                  <div class="index-card-text">
                      <div class="index-card-heading">
                        <h2><%=bookmark.recipe.name.truncate(32)%></h2>
                      </div>
                      <div class="index-card-info">
                          <p><%=bookmark.recipe.cook_time%> minutes</p>
                          <p>Serves <%=bookmark.recipe.serves%></p>
                          <p><%=bookmark.recipe.cuisine%></p>
                          <p>5 stars</p>
                      </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>



      </div>


    </div>
    <div class="recipe-links">
      <%= link_to 'Upload a new recipe', new_recipe_path %>
      <%= link_to 'Back to all recipes', recipes_path %>
    </div>
  </div>
</div>


